<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Read and write binary files in C++ | Simon Lizotte</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Read and write binary files in C++" />
<meta name="author" content="Simon Lizotte" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Binary files – an efficient way to read and write data" />
<meta property="og:description" content="Binary files – an efficient way to read and write data" />
<link rel="canonical" href="https://simonlizotte.ca/guides/tutorials/2020/05/21/guide-on-binary-files-cpp.html" />
<meta property="og:url" content="https://simonlizotte.ca/guides/tutorials/2020/05/21/guide-on-binary-files-cpp.html" />
<meta property="og:site_name" content="Simon Lizotte" />
<meta property="og:image" content="https://simonlizotte.ca/binary-cpp.svg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-21T17:15:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://simonlizotte.ca/binary-cpp.svg" />
<meta property="twitter:title" content="Read and write binary files in C++" />
<script type="application/ld+json">
{"@type":"BlogPosting","image":"https://simonlizotte.ca/binary-cpp.svg","headline":"Read and write binary files in C++","dateModified":"2020-05-21T17:15:00-04:00","datePublished":"2020-05-21T17:15:00-04:00","description":"Binary files – an efficient way to read and write data","mainEntityOfPage":{"@type":"WebPage","@id":"https://simonlizotte.ca/guides/tutorials/2020/05/21/guide-on-binary-files-cpp.html"},"url":"https://simonlizotte.ca/guides/tutorials/2020/05/21/guide-on-binary-files-cpp.html","author":{"@type":"Person","name":"Simon Lizotte"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://simonlizotte.ca/feed.xml" title="Simon Lizotte" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Simon Lizotte</a><div class="header">
      <input class="menu-btn" type="checkbox" id="menu-btn" />
      <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
      
        
        <ul class="menu"><li>
            <a class="page-link" href="/about/">About</a>
            </li><li>
            <a class="page-link" href="/code/">Code</a>
            </li><li>
            <a class="page-link" href="/posts/">Posts</a>
            </li><li>
            <a class="page-link" href="/publications/">Publications</a>
            </li></ul>
        
      
    </div></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      extensions: ["tex2jax.js"],
      "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
      tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
      TeX: { noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } } },
      messageStyle: "none"
    });
  </script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>

  <header class="post-header">
    <h3 class="post-title p-name" itemprop="name headline">Read and write binary files in C++</h3>
    <p class="post-meta"><time class="dt-published" datetime="2020-05-21T17:15:00-04:00" itemprop="datePublished">
        May 21, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Simon Lizotte</span></span></p>
  </header><img src="/assets/images/binary-cpp.svg" ><div class="post-content e-content" itemprop="articleBody">
    <h2 id="binary-files--an-efficient-way-to-read-and-write-data">Binary files – an efficient way to read and write data</h2>

<p>We assume here that the reader is somewhat familiar with the different types and the C++ syntax.</p>

<h3 id="why-binary">Why binary?</h3>
<p>A common way to store data in file is to save it in plain text. In effect, this is simple and convenient. More often than not however, <strong>this is inefficient</strong>: the files are big, slow to write and slow to read. A faster and lighter way of storing data is to directly save its bytes from the memory.</p>

<p>Consider an array of 8 <code class="language-plaintext highlighter-rouge">float</code> values that all have 5 decimals</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.00002</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mf">0.00004</span><span class="p">,</span>
                 <span class="mf">0.00005</span><span class="p">,</span> <span class="mf">0.00006</span><span class="p">,</span> <span class="mf">0.00007</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">};</span>
</code></pre></div></div>
<p>In a text file, this data could be saved by separating each value with a space and by writing the numbers in strings. If the file uses the ASCII character set, every character requires 1 byte. This way, each number would occupy</p>

\[1 \; \frac{\text{byte}}{\text{character}} \times 7\; \frac{\text{characters}}{\text{number}} = 7 \;\frac{\text{bytes}}{\text{number}}.\]

<p>In addition, each character is separated by a space, which adds 7 extra characters to the file. In total, the file size would be</p>

\[7\;\frac{\text{bytes}}{\text{number}} \times 8\;\text{numbers} + 7\; \text{bytes} = 63 \;\text{bytes}.\]

<p>In constrast, the <code class="language-plaintext highlighter-rouge">float</code> type only occupies 4 bytes of memory. In this manner, if the binary reprensation of the numbers is written in the file, its size is</p>

\[8\; \text{numbers}\times 4\;\frac{\text{bytes}}{\text{number}}  = 32 \;\text{bytes}.\]

<p>The file is almost <strong>half the size</strong> of its text counterpart!</p>

<h3 id="how-to-implement-it">How to implement it?</h3>

<p>The process involving writing to binary is more complex and tedious than the usual text file, but it is managable. The first difference is that the flag “binary” must be set to the file stream</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">outputFileStream</span><span class="p">;</span>
<span class="n">outputFileStream</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="o">|</span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
</code></pre></div></div>
<p>In order to write the data in the file, it must be casted (transformed) into an array of characters. This can be done with a C-type cast</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span>
</code></pre></div></div>
<p>Note here that the <strong>reference of the variable</strong> is used. Here comes the trickier part: the number of bytes saved must be passed in argument to the <code class="language-plaintext highlighter-rouge">write</code> method. Even though there is a built-in function <code class="language-plaintext highlighter-rouge">sizeof</code> that returns the size of a type, one must proceed carefully because it does not always give directly the required size.</p>

<p>In the proposed exampled, there are two ways to go about the writing process. The most intuitive way is to loop on the values stored and write them one by one</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">outputFileStream</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</code></pre></div></div>
<p>The second way involves taking advantage of the contiguous memory used by arrays. When the array <code class="language-plaintext highlighter-rouge">data</code> was declared, 8 locations of 4 bytes were allocated to this variable (the 32 bytes that was shown in the last section). It turns out that these are stored one after the other in memory. Knowing that 32 bytes are required, it is possible to write the entire array with a single line of code</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">outputFileStream</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">data</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="nf">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</code></pre></div></div>
<p>The principle to read the data is similar. The input stream is opened in binary</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">inputFileStream</span><span class="p">;</span>
<span class="n">inputFileStream</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="o">|</span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
</code></pre></div></div>
<p>When the file is read with <code class="language-plaintext highlighter-rouge">read</code>, the bytes are copied into the variable passed in argument. In the same manner as for the writing, the size read in bytes must be known.</p>

<p>There are once again two options to read the data: fill each element of the array one by one with a loop</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">fileContent</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">inputFileStream</span><span class="p">.</span><span class="n">read</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">fileContent</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</code></pre></div></div>
<p>and fill the array all at once</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inputFileStream</span><span class="p">.</span><span class="n">read</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">fileContent</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="nf">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>
</code></pre></div></div>
<p>Although it is possible to save more complex data type such as structures and classes in binary, this guide don’t explain it this as it very quickly becomes complicated. A good place to start for a interested reader is (here)<a href="https://isocpp.org/wiki/faq/serialization">serialization-cpp</a>.</p>

<p>Here is a simple program that writes <code class="language-plaintext highlighter-rouge">data</code> into a binary file <code class="language-plaintext highlighter-rouge">foo.bin</code>, reads it and output the values to the console.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;fstream&gt;
#include &lt;iostream&gt;
</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">float</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mf">0.00002</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mf">0.00004</span><span class="p">,</span>
                     <span class="mf">0.00005</span><span class="p">,</span> <span class="mf">0.00006</span><span class="p">,</span> <span class="mf">0.00007</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">};</span>
    <span class="n">ofstream</span> <span class="n">outputFileStream</span><span class="p">(</span><span class="s">"foo.bin"</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">outputFileStream</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="c1">// Alternative to write the data</span>
    <span class="c1">// outputFileStream.write((char*) data, 8*sizeof(float));</span>

    <span class="n">outputFileStream</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="kt">float</span> <span class="n">fileData</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">ifstream</span> <span class="n">inputFileStream</span><span class="p">(</span><span class="s">"foo.bin"</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"File data is</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">inputFileStream</span><span class="p">.</span><span class="n">read</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">fileData</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

    <span class="c1">// Alternative to read the data</span>
    <span class="c1">// inputFileStream.read((char*) &amp;fileData, 8*sizeof(float));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fileData</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">Finished reading</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">inputFileStream</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="n">remove</span><span class="p">(</span><span class="s">"foo.bin"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>


  </div><a class="u-url" href="/guides/tutorials/2020/05/21/guide-on-binary-files-cpp.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          Follow me:
          <div style="margin-top:-10px">
            <div class="column">
              <a href="/feed.xml">
                <svg class="svg-icon orange">
                  <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
                </svg>
              </a>
            </div>
            <div class="social-links"><a rel="me" href="https://github.com/siliz4" title="siliz4"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></div>
          </div>
        </p>
      </div>
      <div class="footer-col">
        <p>Personal website of Simon Lizotte&#39;s published papers, code and various small blog posts.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
